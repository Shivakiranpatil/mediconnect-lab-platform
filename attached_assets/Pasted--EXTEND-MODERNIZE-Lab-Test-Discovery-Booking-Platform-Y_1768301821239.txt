# EXTEND & MODERNIZE - Lab Test Discovery + Booking Platform

You are a senior full-stack engineer and UI/UX designer extending an EXISTING health application with a MODERN UI REDESIGN.

## ‚ö†Ô∏è CRITICAL INSTRUCTIONS

**The codebase already has:**
- React 18 frontend with Tailwind CSS + shadcn/ui
- Firebase Email/Password Authentication
- Supabase PostgreSQL database
- Admin Dashboard, Lab Portal, User PWA

**Your job:**
1. ‚úÖ ADD new features (AI Discovery, Auto-Assignment, etc.)
2. ‚úÖ MODERNIZE the UI/UX completely (new design system)
3. ‚ùå DO NOT rebuild authentication or database connections
4. ‚ùå DO NOT change tech stack (keep React + Firebase + Supabase)

---

## NEW DESIGN SYSTEM (APPLY EVERYWHERE)

### Design Direction
Create a **premium healthcare aesthetic** inspired by:
- Apple Health app (clean, spacious, soft gradients)
- Modern fintech apps (cards, micro-interactions)
- Dubai luxury aesthetic (gold accents, premium feel)

### Color Palette
```css
:root {
  /* Primary */
  --primary: #0066FF;          /* Vibrant blue */
  --primary-light: #E8F1FF;    /* Soft blue bg */
  
  /* Accents */
  --accent-gold: #D4AF37;      /* Premium gold */
  --accent-teal: #00BFA6;      /* Success/health */
  --accent-coral: #FF6B6B;     /* Attention/alerts */
  
  /* Neutrals */
  --bg-primary: #FAFBFC;       /* Main background */
  --bg-card: #FFFFFF;          /* Card background */
  --bg-dark: #0F172A;          /* Dark sections */
  
  /* Text */
  --text-primary: #1E293B;     /* Headlines */
  --text-secondary: #64748B;   /* Body text */
  --text-muted: #94A3B8;       /* Subtle text */
  
  /* Gradients */
  --gradient-primary: linear-gradient(135deg, #0066FF 0%, #00BFA6 100%);
  --gradient-premium: linear-gradient(135deg, #1E293B 0%, #334155 100%);
  --gradient-health: linear-gradient(135deg, #00BFA6 0%, #00D9C4 100%);
}
```

### Typography
```css
/* Font: Inter (clean, modern, highly legible) */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

/* Scale */
--text-xs: 0.75rem;    /* 12px */
--text-sm: 0.875rem;   /* 14px */
--text-base: 1rem;     /* 16px */
--text-lg: 1.125rem;   /* 18px */
--text-xl: 1.25rem;    /* 20px */
--text-2xl: 1.5rem;    /* 24px */
--text-3xl: 2rem;      /* 32px */
--text-4xl: 2.5rem;    /* 40px */
```

### Component Styling
```jsx
// Card Style
className="bg-white rounded-2xl p-6 shadow-sm border border-slate-100 hover:shadow-md transition-all duration-300"

// Primary Button
className="bg-gradient-to-r from-blue-600 to-blue-500 text-white font-semibold px-6 py-3 rounded-xl hover:shadow-lg hover:shadow-blue-500/25 transition-all duration-300"

// Secondary Button
className="bg-slate-100 text-slate-700 font-medium px-6 py-3 rounded-xl hover:bg-slate-200 transition-all"

// Input Field
className="w-full px-4 py-3 rounded-xl border border-slate-200 bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 transition-all outline-none"

// Badge
className="px-3 py-1 rounded-full text-xs font-medium bg-blue-50 text-blue-600"

// Glass Effect (for overlays)
className="backdrop-blur-xl bg-white/80 border border-white/20"
```

### Animations & Micro-interactions
```jsx
// Hover lift effect
className="hover:-translate-y-1 transition-transform duration-300"

// Pulse for CTAs
className="animate-pulse"

// Smooth page transitions
import { motion } from 'framer-motion';
<motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.4 }}>

// Skeleton loading
className="animate-pulse bg-slate-200 rounded-xl"
```

---

## EXISTING TECH STACK (KEEP AS-IS)

| Layer | Technology | Action |
|-------|------------|--------|
| Frontend | React 18 + Tailwind + shadcn/ui | KEEP |
| Auth | Firebase Email/Password | KEEP |
| Database | Supabase PostgreSQL | EXTEND |
| State | React Context | KEEP |
| Services | `/src/config/supabase.js` | EXTEND |

---

## DATABASE EXTENSIONS (ADD TO SUPABASE)

Run this SQL in Supabase SQL Editor:

```sql
-- ================================================
-- NEW TABLES FOR LAB TEST DISCOVERY PLATFORM
-- ================================================

-- Tests catalog
CREATE TABLE IF NOT EXISTS tests (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name TEXT NOT NULL,
    description TEXT,
    category TEXT,
    biomarkers JSONB DEFAULT '[]',
    preparation TEXT,
    turnaround_hours INTEGER DEFAULT 24,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Test bundles (packages)
CREATE TABLE IF NOT EXISTS bundles (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name TEXT NOT NULL,
    slug TEXT UNIQUE,
    description TEXT,
    short_description TEXT,
    category TEXT,
    tags JSONB DEFAULT '[]',
    icon TEXT DEFAULT 'activity',
    color TEXT DEFAULT 'blue',
    base_price DECIMAL(10,2),
    is_popular BOOLEAN DEFAULT FALSE,
    is_active BOOLEAN DEFAULT TRUE,
    sort_order INTEGER DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Bundle to Test mapping
CREATE TABLE IF NOT EXISTS bundle_tests (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    bundle_id UUID REFERENCES bundles(id) ON DELETE CASCADE,
    test_id UUID REFERENCES tests(id) ON DELETE CASCADE,
    UNIQUE(bundle_id, test_id)
);

-- Lab zones (service areas)
CREATE TABLE IF NOT EXISTS lab_zones (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    lab_id UUID REFERENCES partner_labs(id) ON DELETE CASCADE,
    city TEXT NOT NULL,
    area TEXT NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    UNIQUE(lab_id, city, area)
);

-- Lab working hours
CREATE TABLE IF NOT EXISTS lab_hours (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    lab_id UUID REFERENCES partner_labs(id) ON DELETE CASCADE,
    day_of_week INTEGER NOT NULL,
    open_time TIME NOT NULL,
    close_time TIME NOT NULL,
    is_active BOOLEAN DEFAULT TRUE
);

-- Lab bundle pricing
CREATE TABLE IF NOT EXISTS lab_bundle_pricing (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    lab_id UUID REFERENCES partner_labs(id) ON DELETE CASCADE,
    bundle_id UUID REFERENCES bundles(id) ON DELETE CASCADE,
    price DECIMAL(10,2) NOT NULL,
    home_collection_fee DECIMAL(10,2) DEFAULT 50,
    is_active BOOLEAN DEFAULT TRUE,
    UNIQUE(lab_id, bundle_id)
);

-- Lab blackout dates
CREATE TABLE IF NOT EXISTS lab_blackouts (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    lab_id UUID REFERENCES partner_labs(id) ON DELETE CASCADE,
    blackout_date DATE NOT NULL,
    reason TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Booking events (timeline tracking)
CREATE TABLE IF NOT EXISTS booking_events (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    appointment_id UUID REFERENCES appointments(id) ON DELETE CASCADE,
    event_type TEXT NOT NULL,
    event_data JSONB DEFAULT '{}',
    created_by TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- AI Rule Sets
CREATE TABLE IF NOT EXISTS ai_rule_sets (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name TEXT NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    max_bundles INTEGER DEFAULT 3,
    disclaimer_text TEXT DEFAULT 'Educational only. Not medical advice. Confirm with a licensed clinician.',
    forbidden_phrases JSONB DEFAULT '["diagnose", "prescribe", "cure", "treat disease"]',
    require_questions BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- AI Questions
CREATE TABLE IF NOT EXISTS ai_questions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    rule_set_id UUID REFERENCES ai_rule_sets(id) ON DELETE CASCADE,
    question_key TEXT NOT NULL,
    question_text TEXT NOT NULL,
    question_type TEXT DEFAULT 'single',
    options JSONB NOT NULL,
    helper_text TEXT,
    icon TEXT,
    is_required BOOLEAN DEFAULT TRUE,
    is_active BOOLEAN DEFAULT TRUE,
    sort_order INTEGER DEFAULT 0
);

-- AI Mapping Rules
CREATE TABLE IF NOT EXISTS ai_mapping_rules (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    rule_set_id UUID REFERENCES ai_rule_sets(id) ON DELETE CASCADE,
    name TEXT NOT NULL,
    conditions JSONB NOT NULL,
    recommended_bundle_ids JSONB NOT NULL,
    reason_template TEXT,
    priority INTEGER DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- AI Prompts
CREATE TABLE IF NOT EXISTS ai_prompts (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    rule_set_id UUID REFERENCES ai_rule_sets(id) ON DELETE CASCADE,
    prompt_type TEXT NOT NULL,
    prompt_template TEXT NOT NULL,
    json_schema JSONB,
    is_active BOOLEAN DEFAULT TRUE,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- AI Logs
CREATE TABLE IF NOT EXISTS ai_logs (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID,
    session_id TEXT,
    mode TEXT NOT NULL,
    answers_summary JSONB,
    recommended_bundles JSONB,
    llm_response TEXT,
    processing_time_ms INTEGER,
    error_message TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Leads
CREATE TABLE IF NOT EXISTS leads (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    phone TEXT,
    email TEXT,
    name TEXT,
    source TEXT DEFAULT 'ai_discovery',
    ai_answers JSONB,
    recommended_bundles JSONB,
    utm_source TEXT,
    utm_campaign TEXT,
    status TEXT DEFAULT 'new',
    converted_at TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Audit logs
CREATE TABLE IF NOT EXISTS audit_logs (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID,
    user_role TEXT,
    action TEXT NOT NULL,
    entity_type TEXT,
    entity_id UUID,
    old_value JSONB,
    new_value JSONB,
    ip_address TEXT,
    user_agent TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Report snapshots (for analytics)
CREATE TABLE IF NOT EXISTS report_snapshots (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    report_date DATE NOT NULL,
    metrics JSONB NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Extend appointments table
ALTER TABLE appointments ADD COLUMN IF NOT EXISTS bundle_id UUID REFERENCES bundles(id);
ALTER TABLE appointments ADD COLUMN IF NOT EXISTS bundle_name TEXT;
ALTER TABLE appointments ADD COLUMN IF NOT EXISTS home_collection_fee DECIMAL(10,2) DEFAULT 0;
ALTER TABLE appointments ADD COLUMN IF NOT EXISTS total_price DECIMAL(10,2);
ALTER TABLE appointments ADD COLUMN IF NOT EXISTS sla_deadline TIMESTAMP WITH TIME ZONE;
ALTER TABLE appointments ADD COLUMN IF NOT EXISTS sla_breached BOOLEAN DEFAULT FALSE;
ALTER TABLE appointments ADD COLUMN IF NOT EXISTS fasting_required BOOLEAN DEFAULT FALSE;
ALTER TABLE appointments ADD COLUMN IF NOT EXISTS whatsapp_clicked_at TIMESTAMP WITH TIME ZONE;
ALTER TABLE appointments ADD COLUMN IF NOT EXISTS whatsapp_chat_initiated_at TIMESTAMP WITH TIME ZONE;
ALTER TABLE appointments ADD COLUMN IF NOT EXISTS collector_name TEXT;
ALTER TABLE appointments ADD COLUMN IF NOT EXISTS collector_phone TEXT;
ALTER TABLE appointments ADD COLUMN IF NOT EXISTS confirmed_time TEXT;
ALTER TABLE appointments ADD COLUMN IF NOT EXISTS cancellation_reason TEXT;
ALTER TABLE appointments ADD COLUMN IF NOT EXISTS notes TEXT;

-- Extend partner_labs table
ALTER TABLE partner_labs ADD COLUMN IF NOT EXISTS logo_url TEXT;
ALTER TABLE partner_labs ADD COLUMN IF NOT EXISTS description TEXT;
ALTER TABLE partner_labs ADD COLUMN IF NOT EXISTS avg_confirmation_hours DECIMAL(5,2) DEFAULT 2;
ALTER TABLE partner_labs ADD COLUMN IF NOT EXISTS completion_rate DECIMAL(5,4) DEFAULT 0.95;
ALTER TABLE partner_labs ADD COLUMN IF NOT EXISTS cancellation_rate DECIMAL(5,4) DEFAULT 0.02;
ALTER TABLE partner_labs ADD COLUMN IF NOT EXISTS rating DECIMAL(3,2) DEFAULT 4.5;
ALTER TABLE partner_labs ADD COLUMN IF NOT EXISTS total_reviews INTEGER DEFAULT 0;

-- Create indexes
CREATE INDEX IF NOT EXISTS idx_booking_events_appointment ON booking_events(appointment_id);
CREATE INDEX IF NOT EXISTS idx_ai_logs_user ON ai_logs(user_id);
CREATE INDEX IF NOT EXISTS idx_ai_logs_created ON ai_logs(created_at);
CREATE INDEX IF NOT EXISTS idx_leads_status ON leads(status);
CREATE INDEX IF NOT EXISTS idx_appointments_sla ON appointments(sla_deadline);
CREATE INDEX IF NOT EXISTS idx_appointments_bundle ON appointments(bundle_id);
```

---

## SEED DATA

```sql
-- ================================================
-- SEED DATA
-- ================================================

-- Seed Tests
INSERT INTO tests (name, category, description, preparation) VALUES
('Complete Blood Count (CBC)', 'Blood', 'Measures red cells, white cells, hemoglobin, platelets', 'No fasting required'),
('Lipid Profile', 'Heart', 'Total cholesterol, HDL, LDL, triglycerides', '12 hours fasting'),
('Thyroid Panel (TSH, T3, T4)', 'Hormones', 'Complete thyroid function assessment', 'No fasting required'),
('Vitamin D (25-OH)', 'Vitamins', 'Measures vitamin D levels in blood', 'No fasting required'),
('Vitamin B12', 'Vitamins', 'Cobalamin levels for energy and nerves', 'No fasting required'),
('HbA1c', 'Metabolic', 'Average blood sugar over 3 months', 'No fasting required'),
('Fasting Blood Glucose', 'Metabolic', 'Blood sugar after 8-12 hour fast', '8-12 hours fasting'),
('Liver Function Test (LFT)', 'Metabolic', 'ALT, AST, ALP, bilirubin, albumin', 'No fasting required'),
('Kidney Function Test (KFT)', 'Metabolic', 'Creatinine, BUN, eGFR, uric acid', 'No fasting required'),
('Iron Studies', 'Blood', 'Serum iron, ferritin, TIBC, transferrin', '12 hours fasting'),
('Testosterone (Total)', 'Hormones', 'Male hormone levels', 'Morning sample preferred'),
('Estrogen & Progesterone', 'Hormones', 'Female hormone panel', 'Cycle day specific'),
('PSA (Prostate)', 'Men', 'Prostate-specific antigen screening', 'No fasting required'),
('CA-125', 'Women', 'Ovarian cancer marker', 'No fasting required'),
('Cortisol', 'Hormones', 'Stress hormone levels', 'Morning sample required')
ON CONFLICT DO NOTHING;

-- Seed Bundles
INSERT INTO bundles (name, slug, description, short_description, category, icon, color, base_price, is_popular, sort_order) VALUES
('Essential Health Check', 'essential', 'Perfect starting point for anyone wanting to understand their baseline health. Includes key blood markers and vitamins.', 'Great starting point', 'General', 'heart-pulse', 'blue', 199, TRUE, 1),
('Heart Health Panel', 'heart', 'Comprehensive cardiovascular screening including lipid profile, inflammation markers, and heart risk factors.', 'Complete heart screening', 'Heart', 'heart', 'red', 349, TRUE, 2),
('Energy & Vitality', 'energy', 'Feeling tired? This panel checks thyroid, iron, B12, and other key factors affecting your energy levels.', 'Combat fatigue', 'Wellness', 'zap', 'amber', 299, TRUE, 3),
('Diabetes Care', 'diabetes', 'Complete diabetes monitoring including HbA1c, fasting glucose, and kidney function markers.', 'Blood sugar control', 'Metabolic', 'activity', 'cyan', 279, FALSE, 4),
('Thyroid Complete', 'thyroid', 'Full thyroid function panel including TSH, T3, T4, and thyroid antibodies.', 'Thyroid health', 'Hormones', 'thermometer', 'purple', 249, FALSE, 5),
('Women''s Wellness', 'womens', 'Tailored for women including hormones, vitamins, thyroid, and essential health markers.', 'Female health focus', 'Women', 'flower', 'pink', 449, TRUE, 6),
('Men''s Wellness', 'mens', 'Designed for men covering testosterone, PSA, heart health, and key performance markers.', 'Male health focus', 'Men', 'shield', 'indigo', 449, TRUE, 7),
('Full Body Checkup', 'full', 'Our most comprehensive panel covering 50+ biomarkers across all major body systems.', 'Complete picture', 'Premium', 'scan', 'emerald', 699, TRUE, 8),
('Senior Health (55+)', 'senior', 'Age-appropriate comprehensive screening with focus on heart, diabetes, kidney, and bone health.', 'For ages 55+', 'Senior', 'users', 'slate', 549, FALSE, 9),
('Weight & Metabolism', 'weight', 'Understand your metabolism with thyroid, insulin, cortisol, and lipid markers.', 'Metabolism check', 'Metabolic', 'scale', 'orange', 379, FALSE, 10),
('Family Basic Pack', 'family-basic', 'Essential health check for up to 4 family members at a discounted rate.', 'For families', 'Family', 'home', 'teal', 599, TRUE, 11),
('Preventive Premium', 'preventive', 'Our flagship annual health check with advanced cancer markers and genetic risk factors.', 'Most comprehensive', 'Premium', 'shield-check', 'gold', 999, TRUE, 12)
ON CONFLICT (slug) DO NOTHING;

-- Seed Default AI Rule Set
INSERT INTO ai_rule_sets (name, is_active, max_bundles, disclaimer_text, require_questions) 
VALUES ('Default Discovery Rules', TRUE, 3, 'Educational only. Not medical advice. Please confirm with a licensed healthcare provider.', TRUE)
ON CONFLICT DO NOTHING;

-- Seed AI Questions
INSERT INTO ai_questions (rule_set_id, question_key, question_text, question_type, options, helper_text, icon, sort_order)
SELECT 
    id,
    'intent',
    'What brings you here today?',
    'single',
    '["Routine health check", "Monitor existing condition", "Feeling tired or low energy", "Weight or metabolism concerns", "Heart or cholesterol check", "Women''s health", "Men''s health", "Booking for family", "Just exploring options"]'::jsonb,
    'Select the option that best describes your goal',
    'target',
    1
FROM ai_rule_sets WHERE name = 'Default Discovery Rules'
ON CONFLICT DO NOTHING;

INSERT INTO ai_questions (rule_set_id, question_key, question_text, question_type, options, helper_text, icon, sort_order)
SELECT 
    id,
    'conditions',
    'Have you been diagnosed with any of these?',
    'multi',
    '["Diabetes", "Thyroid condition", "PCOS", "High cholesterol", "Hypertension", "None of these", "Prefer not to say"]'::jsonb,
    'Select all that apply (optional)',
    'clipboard-list',
    2
FROM ai_rule_sets WHERE name = 'Default Discovery Rules'
ON CONFLICT DO NOTHING;

INSERT INTO ai_questions (rule_set_id, question_key, question_text, question_type, options, helper_text, icon, sort_order)
SELECT 
    id,
    'age_range',
    'What''s your age group?',
    'single',
    '["Under 25", "25-34", "35-44", "45-54", "55 and above"]'::jsonb,
    'This helps us recommend age-appropriate tests',
    'calendar',
    3
FROM ai_rule_sets WHERE name = 'Default Discovery Rules'
ON CONFLICT DO NOTHING;

INSERT INTO ai_questions (rule_set_id, question_key, question_text, question_type, options, helper_text, icon, sort_order)
SELECT 
    id,
    'collection_preference',
    'How would you like your sample collected?',
    'single',
    '[{"label": "Home collection", "value": "home", "icon": "home"}, {"label": "Visit a lab", "value": "lab", "icon": "building"}, {"label": "Either works", "value": "either", "icon": "check-circle"}]'::jsonb,
    'Home collection has a small additional fee',
    'map-pin',
    4
FROM ai_rule_sets WHERE name = 'Default Discovery Rules'
ON CONFLICT DO NOTHING;

-- Seed AI Mapping Rules
INSERT INTO ai_mapping_rules (rule_set_id, name, conditions, recommended_bundle_ids, reason_template, priority)
SELECT 
    rs.id,
    'Routine Health Check',
    '{"intent": "Routine health check"}'::jsonb,
    (SELECT jsonb_agg(id) FROM bundles WHERE slug IN ('essential', 'full')),
    'Based on your interest in routine health monitoring, we recommend starting with these comprehensive panels.',
    10
FROM ai_rule_sets rs WHERE rs.name = 'Default Discovery Rules'
ON CONFLICT DO NOTHING;

INSERT INTO ai_mapping_rules (rule_set_id, name, conditions, recommended_bundle_ids, reason_template, priority)
SELECT 
    rs.id,
    'Energy & Fatigue',
    '{"intent": "Feeling tired or low energy"}'::jsonb,
    (SELECT jsonb_agg(id) FROM bundles WHERE slug IN ('energy', 'thyroid', 'essential')),
    'Fatigue can have many causes. These panels check thyroid, iron, B12, and other key energy markers.',
    10
FROM ai_rule_sets rs WHERE rs.name = 'Default Discovery Rules'
ON CONFLICT DO NOTHING;

INSERT INTO ai_mapping_rules (rule_set_id, name, conditions, recommended_bundle_ids, reason_template, priority)
SELECT 
    rs.id,
    'Heart Health Focus',
    '{"intent": "Heart or cholesterol check"}'::jsonb,
    (SELECT jsonb_agg(id) FROM bundles WHERE slug IN ('heart', 'full')),
    'Heart health is crucial. These panels cover comprehensive cardiovascular markers.',
    10
FROM ai_rule_sets rs WHERE rs.name = 'Default Discovery Rules'
ON CONFLICT DO NOTHING;

INSERT INTO ai_mapping_rules (rule_set_id, name, conditions, recommended_bundle_ids, reason_template, priority)
SELECT 
    rs.id,
    'Diabetes Management',
    '{"conditions": ["Diabetes"]}'::jsonb,
    (SELECT jsonb_agg(id) FROM bundles WHERE slug IN ('diabetes', 'full')),
    'For diabetes monitoring, these panels track blood sugar control and related health markers.',
    20
FROM ai_rule_sets rs WHERE rs.name = 'Default Discovery Rules'
ON CONFLICT DO NOTHING;

INSERT INTO ai_mapping_rules (rule_set_id, name, conditions, recommended_bundle_ids, reason_template, priority)
SELECT 
    rs.id,
    'Senior Health',
    '{"age_range": "55 and above"}'::jsonb,
    (SELECT jsonb_agg(id) FROM bundles WHERE slug IN ('senior', 'full', 'heart')),
    'For your age group, we recommend comprehensive screening with focus on age-specific markers.',
    15
FROM ai_rule_sets rs WHERE rs.name = 'Default Discovery Rules'
ON CONFLICT DO NOTHING;

INSERT INTO ai_mapping_rules (rule_set_id, name, conditions, recommended_bundle_ids, reason_template, priority)
SELECT 
    rs.id,
    'Womens Health',
    '{"intent": "Women''s health"}'::jsonb,
    (SELECT jsonb_agg(id) FROM bundles WHERE slug IN ('womens', 'thyroid', 'essential')),
    'Our women-focused panels cover hormones, thyroid, and essential female health markers.',
    10
FROM ai_rule_sets rs WHERE rs.name = 'Default Discovery Rules'
ON CONFLICT DO NOTHING;

INSERT INTO ai_mapping_rules (rule_set_id, name, conditions, recommended_bundle_ids, reason_template, priority)
SELECT 
    rs.id,
    'Mens Health',
    '{"intent": "Men''s health"}'::jsonb,
    (SELECT jsonb_agg(id) FROM bundles WHERE slug IN ('mens', 'heart', 'essential')),
    'Our mens wellness panel covers testosterone, PSA, and key male health markers.',
    10
FROM ai_rule_sets rs WHERE rs.name = 'Default Discovery Rules'
ON CONFLICT DO NOTHING;

-- Add zones to existing labs
INSERT INTO lab_zones (lab_id, city, area)
SELECT id, 'Dubai', 'Business Bay' FROM partner_labs WHERE emirate = 'Dubai' ON CONFLICT DO NOTHING;
INSERT INTO lab_zones (lab_id, city, area)
SELECT id, 'Dubai', 'Marina' FROM partner_labs WHERE emirate = 'Dubai' ON CONFLICT DO NOTHING;
INSERT INTO lab_zones (lab_id, city, area)
SELECT id, 'Dubai', 'Downtown' FROM partner_labs WHERE emirate = 'Dubai' ON CONFLICT DO NOTHING;
INSERT INTO lab_zones (lab_id, city, area)
SELECT id, 'Dubai', 'JBR' FROM partner_labs WHERE emirate = 'Dubai' ON CONFLICT DO NOTHING;
INSERT INTO lab_zones (lab_id, city, area)
SELECT id, 'Abu Dhabi', 'Al Reem Island' FROM partner_labs WHERE emirate = 'Abu Dhabi' ON CONFLICT DO NOTHING;
INSERT INTO lab_zones (lab_id, city, area)
SELECT id, 'Abu Dhabi', 'Corniche' FROM partner_labs WHERE emirate = 'Abu Dhabi' ON CONFLICT DO NOTHING;
INSERT INTO lab_zones (lab_id, city, area)
SELECT id, 'Sharjah', 'Al Nahda' FROM partner_labs WHERE emirate = 'Sharjah' ON CONFLICT DO NOTHING;

-- Add bundle pricing for all labs
INSERT INTO lab_bundle_pricing (lab_id, bundle_id, price, home_collection_fee)
SELECT pl.id, b.id, b.base_price, 50
FROM partner_labs pl
CROSS JOIN bundles b
WHERE pl.status = 'active'
ON CONFLICT (lab_id, bundle_id) DO NOTHING;

-- Add working hours for labs (7 AM to 9 PM, all days)
INSERT INTO lab_hours (lab_id, day_of_week, open_time, close_time)
SELECT pl.id, d.day, '07:00'::TIME, '21:00'::TIME
FROM partner_labs pl
CROSS JOIN (SELECT generate_series(0, 6) AS day) d
WHERE pl.status = 'active'
ON CONFLICT DO NOTHING;
```

---

## NEW PAGE DESIGNS

### 1. Homepage Redesign (`/src/pages/HomePage.jsx`)

**Hero Section:**
```jsx
// Modern hero with gradient background and floating elements
<section className="relative min-h-[500px] bg-gradient-to-br from-blue-600 via-blue-500 to-teal-400 overflow-hidden">
  {/* Floating shapes */}
  <div className="absolute top-20 right-20 w-64 h-64 bg-white/10 rounded-full blur-3xl" />
  <div className="absolute bottom-10 left-10 w-48 h-48 bg-teal-300/20 rounded-full blur-2xl" />
  
  <div className="container mx-auto px-4 py-16 relative z-10">
    <div className="max-w-2xl">
      <span className="inline-block px-4 py-2 bg-white/20 backdrop-blur-sm rounded-full text-white text-sm font-medium mb-6">
        üè• Trusted by 10,000+ families in UAE
      </span>
      <h1 className="text-4xl md:text-5xl font-bold text-white mb-6 leading-tight">
        Your Health Journey<br />Starts Here
      </h1>
      <p className="text-xl text-white/90 mb-8">
        AI-powered test recommendations. Home collection. Results you understand.
      </p>
      <button className="bg-white text-blue-600 font-semibold px-8 py-4 rounded-xl hover:shadow-2xl transition-all duration-300 flex items-center gap-2">
        <Sparkles className="w-5 h-5" />
        Find My Tests
      </button>
    </div>
  </div>
</section>
```

**Quick Actions Grid:**
```jsx
<section className="py-12 bg-slate-50">
  <div className="container mx-auto px-4">
    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
      {[
        { icon: Sparkles, label: 'AI Discovery', desc: 'Personalized recommendations', color: 'from-violet-500 to-purple-500' },
        { icon: Search, label: 'Browse Tests', desc: 'Explore all packages', color: 'from-blue-500 to-cyan-500' },
        { icon: Calendar, label: 'Book Now', desc: 'Schedule collection', color: 'from-teal-500 to-emerald-500' },
        { icon: FileText, label: 'My Reports', desc: 'View results', color: 'from-orange-500 to-amber-500' },
      ].map((item, i) => (
        <button key={i} className="group bg-white p-6 rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300">
          <div className={`w-12 h-12 rounded-xl bg-gradient-to-br ${item.color} flex items-center justify-center mb-4 group-hover:scale-110 transition-transform`}>
            <item.icon className="w-6 h-6 text-white" />
          </div>
          <h3 className="font-semibold text-slate-800">{item.label}</h3>
          <p className="text-sm text-slate-500">{item.desc}</p>
        </button>
      ))}
    </div>
  </div>
</section>
```

**Popular Bundles Carousel:**
```jsx
<section className="py-12">
  <div className="container mx-auto px-4">
    <div className="flex justify-between items-center mb-8">
      <div>
        <h2 className="text-2xl font-bold text-slate-800">Popular Health Packages</h2>
        <p className="text-slate-500">Most chosen by customers in Dubai</p>
      </div>
      <button className="text-blue-600 font-medium flex items-center gap-1 hover:gap-2 transition-all">
        View All <ChevronRight className="w-4 h-4" />
      </button>
    </div>
    
    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
      {bundles.filter(b => b.is_popular).map(bundle => (
        <BundleCard key={bundle.id} bundle={bundle} />
      ))}
    </div>
  </div>
</section>
```

### 2. AI Discovery Flow (`/src/pages/AIDiscoveryPage.jsx`)

**Full-screen wizard with modern UI:**
```jsx
const AIDiscoveryPage = () => {
  const [step, setStep] = useState(0);
  const [answers, setAnswers] = useState({});
  
  return (
    <div className="min-h-screen bg-gradient-to-b from-slate-50 to-white">
      {/* Progress bar */}
      <div className="fixed top-0 left-0 right-0 h-1 bg-slate-200 z-50">
        <div 
          className="h-full bg-gradient-to-r from-blue-600 to-teal-500 transition-all duration-500"
          style={{ width: `${((step + 1) / 4) * 100}%` }}
        />
      </div>
      
      {/* Header */}
      <header className="fixed top-0 left-0 right-0 bg-white/80 backdrop-blur-xl border-b border-slate-100 z-40">
        <div className="container mx-auto px-4 h-16 flex items-center justify-between">
          <button onClick={() => navigate(-1)} className="p-2 hover:bg-slate-100 rounded-xl">
            <ArrowLeft className="w-5 h-5" />
          </button>
          <span className="text-sm font-medium text-slate-500">
            Step {step + 1} of 4
          </span>
          <button className="p-2 hover:bg-slate-100 rounded-xl">
            <X className="w-5 h-5" />
          </button>
        </div>
      </header>
      
      {/* Question content */}
      <main className="pt-24 pb-32 px-4">
        <motion.div
          key={step}
          initial={{ opacity: 0, x: 20 }}
          animate={{ opacity: 1, x: 0 }}
          exit={{ opacity: 0, x: -20 }}
          className="max-w-lg mx-auto"
        >
          <div className="text-center mb-8">
            <div className="w-16 h-16 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-blue-500 to-teal-500 flex items-center justify-center">
              <QuestionIcon className="w-8 h-8 text-white" />
            </div>
            <h1 className="text-2xl font-bold text-slate-800 mb-2">
              {questions[step].text}
            </h1>
            <p className="text-slate-500">
              {questions[step].helper}
            </p>
          </div>
          
          {/* Options */}
          <div className="space-y-3">
            {questions[step].options.map((option, i) => (
              <button
                key={i}
                onClick={() => handleSelect(option)}
                className={`w-full p-4 rounded-2xl border-2 transition-all duration-200 text-left flex items-center gap-4 ${
                  answers[questions[step].key] === option
                    ? 'border-blue-500 bg-blue-50'
                    : 'border-slate-200 hover:border-slate-300 bg-white'
                }`}
              >
                <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${
                  answers[questions[step].key] === option
                    ? 'border-blue-500 bg-blue-500'
                    : 'border-slate-300'
                }`}>
                  {answers[questions[step].key] === option && (
                    <Check className="w-4 h-4 text-white" />
                  )}
                </div>
                <span className="font-medium text-slate-700">{option}</span>
              </button>
            ))}
          </div>
        </motion.div>
      </main>
      
      {/* Bottom navigation */}
      <footer className="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-100 p-4">
        <div className="max-w-lg mx-auto flex gap-3">
          {step > 0 && (
            <button 
              onClick={() => setStep(s => s - 1)}
              className="px-6 py-3 rounded-xl border border-slate-200 font-medium"
            >
              Back
            </button>
          )}
          <button 
            onClick={handleNext}
            disabled={!answers[questions[step].key]}
            className="flex-1 bg-gradient-to-r from-blue-600 to-blue-500 text-white font-semibold py-3 rounded-xl disabled:opacity-50 disabled:cursor-not-allowed"
          >
            {step === 3 ? 'See My Recommendations' : 'Continue'}
          </button>
        </div>
      </footer>
    </div>
  );
};
```

### 3. AI Results Page (`/src/pages/AIResultsPage.jsx`)

```jsx
const AIResultsPage = () => {
  return (
    <div className="min-h-screen bg-slate-50">
      {/* Success header */}
      <div className="bg-gradient-to-br from-blue-600 to-teal-500 text-white py-12 px-4">
        <div className="max-w-lg mx-auto text-center">
          <div className="w-20 h-20 mx-auto mb-4 bg-white/20 rounded-full flex items-center justify-center">
            <Sparkles className="w-10 h-10" />
          </div>
          <h1 className="text-2xl font-bold mb-2">Your Personalized Recommendations</h1>
          <p className="text-white/80">Based on your health goals and profile</p>
        </div>
      </div>
      
      {/* Recommendations */}
      <div className="px-4 -mt-6">
        <div className="max-w-lg mx-auto space-y-4">
          {recommendations.map((bundle, i) => (
            <motion.div
              key={bundle.id}
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: i * 0.1 }}
              className="bg-white rounded-2xl shadow-lg overflow-hidden"
            >
              {i === 0 && (
                <div className="bg-gradient-to-r from-amber-500 to-orange-500 text-white text-xs font-semibold px-4 py-1 text-center">
                  ‚≠ê Best Match for You
                </div>
              )}
              <div className="p-6">
                <div className="flex justify-between items-start mb-4">
                  <div>
                    <h3 className="text-lg font-bold text-slate-800">{bundle.name}</h3>
                    <p className="text-sm text-slate-500">{bundle.short_description}</p>
                  </div>
                  <div className="text-right">
                    <p className="text-2xl font-bold text-blue-600">AED {bundle.price}</p>
                    <p className="text-xs text-slate-400">incl. home collection</p>
                  </div>
                </div>
                
                <p className="text-sm text-slate-600 mb-4 bg-blue-50 p-3 rounded-xl">
                  üí° {bundle.reason}
                </p>
                
                <div className="flex gap-3">
                  <button className="flex-1 bg-gradient-to-r from-blue-600 to-blue-500 text-white font-semibold py-3 rounded-xl">
                    Book Home Collection
                  </button>
                  <button className="px-4 py-3 border border-slate-200 rounded-xl">
                    <Info className="w-5 h-5 text-slate-400" />
                  </button>
                </div>
              </div>
            </motion.div>
          ))}
        </div>
      </div>
      
      {/* Disclaimer */}
      <div className="max-w-lg mx-auto px-4 py-8">
        <div className="bg-amber-50 border border-amber-200 rounded-xl p-4 flex gap-3">
          <AlertTriangle className="w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5" />
          <p className="text-sm text-amber-800">
            Educational only. Not medical advice. Please confirm with a licensed healthcare provider.
          </p>
        </div>
      </div>
    </div>
  );
};
```

### 4. Admin Dashboard Redesign (`/src/pages/admin/AdminDashboard.jsx`)

```jsx
// Modern admin dashboard with glass effects and gradients
const AdminDashboard = () => {
  return (
    <div className="min-h-screen bg-slate-900">
      {/* Stat cards */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 p-6">
        {stats.map((stat, i) => (
          <div key={i} className="relative overflow-hidden bg-gradient-to-br from-slate-800 to-slate-800/50 rounded-2xl p-6 border border-slate-700">
            <div className={`absolute top-0 right-0 w-32 h-32 bg-gradient-to-br ${stat.gradient} opacity-20 rounded-full -translate-y-1/2 translate-x-1/2`} />
            <div className="relative">
              <div className={`w-12 h-12 rounded-xl bg-gradient-to-br ${stat.gradient} flex items-center justify-center mb-4`}>
                <stat.icon className="w-6 h-6 text-white" />
              </div>
              <p className="text-3xl font-bold text-white">{stat.value}</p>
              <p className="text-slate-400">{stat.label}</p>
              <div className="flex items-center gap-1 mt-2">
                <TrendingUp className="w-4 h-4 text-emerald-400" />
                <span className="text-sm text-emerald-400">{stat.change}</span>
              </div>
            </div>
          </div>
        ))}
      </div>
      
      {/* Charts section */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 p-6 pt-0">
        <div className="bg-slate-800/50 backdrop-blur-xl rounded-2xl p-6 border border-slate-700">
          <h3 className="text-lg font-semibold text-white mb-4">Bookings Overview</h3>
          <Recharts.AreaChart data={chartData}>
            {/* Chart implementation */}
          </Recharts.AreaChart>
        </div>
        
        <div className="bg-slate-800/50 backdrop-blur-xl rounded-2xl p-6 border border-slate-700">
          <h3 className="text-lg font-semibold text-white mb-4">Revenue Trend</h3>
          <Recharts.BarChart data={revenueData}>
            {/* Chart implementation */}
          </Recharts.BarChart>
        </div>
      </div>
    </div>
  );
};
```

### 5. Admin AI Rules Section (`/src/pages/admin/AdminAIRules.jsx`)

```jsx
// Tabbed interface for AI management
const AdminAIRules = () => {
  const [activeTab, setActiveTab] = useState('rules');
  
  const tabs = [
    { id: 'rules', label: 'Rule Sets', icon: Settings },
    { id: 'questions', label: 'Questions', icon: HelpCircle },
    { id: 'mapping', label: 'Mapping Rules', icon: GitBranch },
    { id: 'prompts', label: 'Prompts', icon: FileText },
    { id: 'playground', label: 'Playground', icon: Play },
    { id: 'logs', label: 'AI Logs', icon: ScrollText },
  ];
  
  return (
    <div className="p-6">
      <div className="mb-6">
        <h1 className="text-2xl font-bold text-white">AI & Rules Management</h1>
        <p className="text-slate-400">Configure AI recommendations and discovery flow</p>
      </div>
      
      {/* Tab navigation */}
      <div className="flex gap-2 mb-6 overflow-x-auto pb-2">
        {tabs.map(tab => (
          <button
            key={tab.id}
            onClick={() => setActiveTab(tab.id)}
            className={`flex items-center gap-2 px-4 py-2 rounded-xl font-medium whitespace-nowrap transition-all ${
              activeTab === tab.id
                ? 'bg-blue-600 text-white'
                : 'bg-slate-800 text-slate-400 hover:bg-slate-700'
            }`}
          >
            <tab.icon className="w-4 h-4" />
            {tab.label}
          </button>
        ))}
      </div>
      
      {/* Tab content */}
      <div className="bg-slate-800/50 backdrop-blur-xl rounded-2xl border border-slate-700">
        {activeTab === 'rules' && <RuleSetsTab />}
        {activeTab === 'questions' && <QuestionsTab />}
        {activeTab === 'mapping' && <MappingRulesTab />}
        {activeTab === 'prompts' && <PromptsTab />}
        {activeTab === 'playground' && <PlaygroundTab />}
        {activeTab === 'logs' && <AILogsTab />}
      </div>
    </div>
  );
};
```

---

## NEW ROUTES (Add to App.js)

```jsx
// Add these routes inside the existing Routes component

// AI Discovery
<Route path="/discover" element={<ProtectedRoute><AIDiscoveryPage /></ProtectedRoute>} />
<Route path="/discover/results" element={<ProtectedRoute><AIResultsPage /></ProtectedRoute>} />
<Route path="/bundles" element={<BundlesPage />} />
<Route path="/bundles/:slug" element={<BundleDetailPage />} />

// Inside AdminLayout routes
<Route path="ai-rules" element={<AdminAIRules />} />
<Route path="catalog" element={<AdminCatalog />} />
<Route path="bookings" element={<AdminBookings />} />
<Route path="audit" element={<AdminAuditLog />} />

// Inside LabLayout routes
<Route path="zones" element={<LabZones />} />
<Route path="pricing" element={<LabPricing />} />
<Route path="hours" element={<LabHours />} />
```

---

## SERVICES TO ADD (in supabase.js)

```javascript
// Add these to existing /src/config/supabase.js

// ============== AI DISCOVERY SERVICE ==============
export const aiDiscoveryService = {
  async getActiveRuleSet() {
    const { data } = await supabase
      .from('ai_rule_sets')
      .select('*, ai_questions(*), ai_mapping_rules(*)')
      .eq('is_active', true)
      .single();
    return data;
  },

  async getQuestions(ruleSetId) {
    const { data } = await supabase
      .from('ai_questions')
      .select('*')
      .eq('rule_set_id', ruleSetId)
      .eq('is_active', true)
      .order('sort_order');
    return data || [];
  },

  async evaluateRules(answers) {
    const ruleSet = await this.getActiveRuleSet();
    if (!ruleSet) return { bundles: [], reason: 'No active rule set' };

    const matchedBundles = new Set();
    let bestReason = '';

    for (const rule of ruleSet.ai_mapping_rules || []) {
      if (!rule.is_active) continue;
      if (this.matchesConditions(rule.conditions, answers)) {
        rule.recommended_bundle_ids?.forEach(id => matchedBundles.add(id));
        if (!bestReason && rule.reason_template) {
          bestReason = rule.reason_template;
        }
      }
    }

    const bundleIds = Array.from(matchedBundles).slice(0, ruleSet.max_bundles || 3);
    const { data: bundles } = await supabase
      .from('bundles')
      .select('*')
      .in('id', bundleIds);

    return {
      bundles: bundles || [],
      reason: bestReason,
      disclaimer: ruleSet.disclaimer_text
    };
  },

  matchesConditions(conditions, answers) {
    for (const [key, expected] of Object.entries(conditions || {})) {
      const actual = answers[key];
      if (Array.isArray(expected)) {
        if (!expected.includes(actual)) return false;
      } else if (typeof expected === 'object') {
        if (expected.includes && Array.isArray(actual)) {
          if (!expected.includes.some(e => actual.includes(e))) return false;
        }
      } else if (actual !== expected) {
        return false;
      }
    }
    return true;
  },

  async logInteraction(userId, mode, answers, bundles, error = null) {
    await supabase.from('ai_logs').insert({
      user_id: userId,
      mode,
      answers_summary: answers,
      recommended_bundles: bundles?.map(b => b.id),
      error_message: error
    });
  }
};

// ============== CATALOG SERVICE ==============
export const catalogService = {
  async getBundles(filters = {}) {
    let query = supabase.from('bundles').select('*').eq('is_active', true);
    if (filters.category) query = query.eq('category', filters.category);
    if (filters.popular) query = query.eq('is_popular', true);
    const { data } = await query.order('sort_order');
    return data || [];
  },

  async getBundleBySlug(slug) {
    const { data } = await supabase
      .from('bundles')
      .select('*, bundle_tests(tests(*))')
      .eq('slug', slug)
      .single();
    return data;
  },

  async getTests() {
    const { data } = await supabase.from('tests').select('*').eq('is_active', true);
    return data || [];
  }
};

// ============== AUTO ASSIGNMENT SERVICE ==============
export const autoAssignService = {
  async findBestLab(bundleId, city, area) {
    const { data: labs } = await supabase
      .from('partner_labs')
      .select(`
        *,
        lab_zones!inner(city, area),
        lab_bundle_pricing!inner(bundle_id, price, home_collection_fee)
      `)
      .eq('status', 'active')
      .eq('lab_zones.city', city)
      .eq('lab_bundle_pricing.bundle_id', bundleId)
      .eq('lab_bundle_pricing.is_active', true);

    if (!labs?.length) return null;

    // Score and sort labs
    const scored = labs.map(lab => ({
      ...lab,
      score: this.calculateScore(lab)
    })).sort((a, b) => b.score - a.score);

    return scored[0];
  },

  calculateScore(lab) {
    const reliability = (lab.completion_rate || 0.9) * 40;
    const speed = (1 - Math.min(lab.avg_confirmation_hours || 2, 24) / 24) * 30;
    const pricing = lab.lab_bundle_pricing?.[0]?.price || 500;
    const priceScore = (1 - Math.min(pricing, 1000) / 1000) * 20;
    const capacity = (1 - (lab.current_load || 0) / (lab.capacity_per_day || 50)) * 10;
    return reliability + speed + priceScore + capacity;
  },

  async assignToBooking(appointmentId, lab) {
    const pricing = lab.lab_bundle_pricing?.[0];
    await supabase.from('appointments').update({
      assigned_lab_id: lab.id,
      assigned_lab_name: lab.name,
      assignment_type: 'auto',
      total_price: (pricing?.price || 0) + (pricing?.home_collection_fee || 0),
      home_collection_fee: pricing?.home_collection_fee || 0,
      sla_deadline: new Date(Date.now() + 2 * 60 * 60 * 1000).toISOString() // 2 hour SLA
    }).eq('id', appointmentId);

    await this.logEvent(appointmentId, 'LAB_AUTO_ASSIGNED', {
      lab_id: lab.id,
      lab_name: lab.name,
      score: lab.score
    });
  },

  async logEvent(appointmentId, eventType, data) {
    await supabase.from('booking_events').insert({
      appointment_id: appointmentId,
      event_type: eventType,
      event_data: data
    });
  }
};

// ============== WHATSAPP TRACKING ==============
export const whatsappService = {
  async trackClick(appointmentId) {
    await supabase.from('appointments').update({
      whatsapp_clicked_at: new Date().toISOString()
    }).eq('id', appointmentId);
    
    await supabase.from('booking_events').insert({
      appointment_id: appointmentId,
      event_type: 'WHATSAPP_CLICKED'
    });
  },

  async markChatInitiated(appointmentId, labUserId) {
    await supabase.from('appointments').update({
      whatsapp_chat_initiated_at: new Date().toISOString()
    }).eq('id', appointmentId);
    
    await supabase.from('booking_events').insert({
      appointment_id: appointmentId,
      event_type: 'WHATSAPP_CHAT_INITIATED',
      created_by: labUserId
    });
  }
};
```

---

## SAFETY & COMPLIANCE (ALWAYS ENFORCE)

```javascript
// Emergency detection - add to AI service
const EMERGENCY_KEYWORDS = ['chest pain', 'heart attack', 'stroke', 'fainting', 'unconscious', 'severe bleeding', 'suicidal', 'suicide', 'self harm'];

export const checkEmergency = (text) => {
  const lower = (text || '').toLowerCase();
  for (const keyword of EMERGENCY_KEYWORDS) {
    if (lower.includes(keyword)) {
      return {
        isEmergency: true,
        message: 'üö® Please seek urgent medical care or call emergency services immediately. In UAE, call 999 or 998.'
      };
    }
  }
  return { isEmergency: false };
};

// Always show disclaimer
const DISCLAIMER = "Educational only. Not medical advice. Please confirm with a licensed healthcare provider.";
```

---

## IMPLEMENTATION ORDER

1. **Day 1: Database & Services**
   - Run SQL schema extensions
   - Run seed data
   - Add new services to supabase.js

2. **Day 2: AI Discovery Flow**
   - Create AIDiscoveryPage.jsx
   - Create AIResultsPage.jsx
   - Add routes to App.js

3. **Day 3: Homepage & Bundle Pages**
   - Redesign HomePage.jsx (modern UI)
   - Create BundlesPage.jsx
   - Create BundleDetailPage.jsx

4. **Day 4: Admin Redesign**
   - Modernize AdminDashboard.jsx
   - Create AdminAIRules.jsx
   - Create AdminCatalog.jsx
   - Create AdminBookings.jsx

5. **Day 5: Lab Portal Enhancements**
   - Modernize LabDashboard.jsx
   - Add SLA countdown
   - Add WhatsApp tracking
   - Add zone/pricing management

6. **Day 6: Polish & Integration**
   - Auto-assignment integration
   - Booking flow updates
   - Mobile responsiveness
   - Testing

---

## INSTALL ADDITIONAL PACKAGES

```bash
npm install framer-motion recharts @tanstack/react-table lucide-react
```

---

## DO NOT CHANGE:
- ‚ùå Authentication system (Firebase)
- ‚ùå Database connection (Supabase)
- ‚ùå Core auth context
- ‚ùå Existing API patterns

## DO CHANGE:
- ‚úÖ All UI/UX (complete redesign)
- ‚úÖ Add new pages and components
- ‚úÖ Add new database tables
- ‚úÖ Add new services
- ‚úÖ Modernize existing pages

---

**START BY:**
1. Run the database SQL in Supabase
2. Add services to supabase.js
3. Install framer-motion: `npm install framer-motion`
4. Start with AIDiscoveryPage.jsx

Build something beautiful! üöÄ